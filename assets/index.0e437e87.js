var j=Object.defineProperty,R=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var S=(e,u,t)=>u in e?j(e,u,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[u]=t,x=(e,u)=>{for(var t in u||(u={}))L.call(u,t)&&S(e,t,u[t]);if(y)for(var t of y(u))V.call(u,t)&&S(e,t,u[t]);return e},k=(e,u)=>R(e,z(u));import{j as q,a as H,F as O,u as X,b as Y,c as Q,l as D,y as g,I as U,R as W,d as G,A as J,e as Z,S as _,P as ee}from"./vendor.5bac71e7.js";const ue=function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}};ue();var te="/superhappy-xiaoxiaole/assets/gongxi.0004c5fc.jpg",ne="/superhappy-xiaoxiaole/assets/huhu.634fe978.jpg",se="/superhappy-xiaoxiaole/assets/shule.791217d4.jpg",oe="/superhappy-xiaoxiaole/assets/tuiqian.d8ef1906.jpg",re="/superhappy-xiaoxiaole/assets/wufu.a8a9acd8.jpg",le="/superhappy-xiaoxiaole/assets/xinniankuaile.b2a8d8fb.jpg";const ae=6,E=6,ce=5,K=["",le,ne,se,oe,re,te],ie=[0,1e3,200,-100,-200,300,500],de=["","\u65B0 \u5E74 \u5FEB \u4E50 \uFF01","\u773C\u955C\u54E5\u306E\u5450\u558A","\u518D\u8FD9\u6837\u4E0B\u53BB...","xxx! xx!","\u72EC\u4E2D\u4E94\u5143\uFF01","\u54CE\u54DF\uFF01"],i=[[-1e4,"\u6FD2\u4E34\u89E3\u6563"],[0,"\u7403\u961F\u7EC4\u5EFA"],[1e3,"\u6821\u961F\u51A0\u519B"],[2e3,"\u5E02\u961F\u51A0\u519B"],[5e3,"\u7701\u961F\u51A0\u519B"],[1e4,"\u5165\u9009\u56FD\u5BB6\u961F"],[15e3,"\u56FD\u5BB6\u961F\u9996\u80DC"],[18e3,"\u56FD\u5BB6\u961F\u8FDE\u80DC"],[2e4,"\u4E09\u8FDE\u80DC\uFF01"],[22e3,"\u4E9A\u6D32\u676F\u9996\u6218"],[25e3,"\u4E9A\u6D32\u676F\u9996\u80DC\uFF01"],[26e3,"\u4E9A\u6D32\u676F\u6253\u8D25\u8D8A\u5357\uFF01"],[3e4,"\u4E9A\u6D32\u676F\u6253\u8D25\u97E9\u56FD\uFF01"],[35e3,"\u4E9A\u6D32\u676F\u6253\u8D25\u65E5\u672C\uFF01"]];let fe=1;const r=[],F={},he=()=>Math.floor(Math.random()*ae)+1,P=()=>({id:fe++,value:he(),isKilled:!1,isDeleted:!1}),pe=(e=10)=>{r.splice(0);for(let u=0;u<e;u+=1){r.push([]);for(let t=0;t<e;t+=1)r[u].push(P())}},Fe=()=>{const e={};r.forEach((t,o)=>{t.forEach((n,s)=>{F[n.id]=k(x({},n),{pos:[s,o]}),e[n.id]=!0})});const u=[];for(const t in F)e[t]?u.push(F[t]):delete F[t];return u},ve=(e,u)=>{[r[e[0]][e[1]],r[u[0]][u[1]]]=[r[u[0]][u[1]],r[e[0]][e[1]]]},w=(e,u,t)=>{e[u]||(e[u]=new Set),t.forEach(o=>{e[u].add(o.id)})},me=()=>{const e=r.length,u=r[0].length,t={};let o=!1;for(let n=0;n<e;n++)for(let s=0;s<u-2;s++)r[n][s].value===r[n][s+1].value&&r[n][s+1].value===r[n][s+2].value&&(r[n][s].isKilled=!0,r[n][s+1].isKilled=!0,r[n][s+2].isKilled=!0,w(t,r[n][s].value,[r[n][s],r[n][s+1],r[n][s+2]]),o=!0);for(let n=0;n<e-2;n++)for(let s=0;s<u;s++)r[n][s].value===r[n+1][s].value&&r[n+1][s].value===r[n+2][s].value&&(r[n][s].isKilled=!0,r[n+1][s].isKilled=!0,r[n+2][s].isKilled=!0,w(t,r[n][s].value,[r[n][s],r[n+1][s],r[n+2][s]]),o=!0);return o?t:null},ge=()=>{const e=r.length,u=r[0].length;for(let t=0;t<u;t+=1){let o=0;for(let n=e-1;n>=0;n-=1){if(r[n][t].isKilled){o+=1;continue}r[n+o][t]=x({},r[n][t])}for(let n=o-1;n>=0;n-=1)r[n][t].isDeleted=!0}},De=()=>{const e=r.length,u=r[0].length;for(let t=0;t<u;t+=1)for(let o=e-1;o>=0;o-=1)r[o][t].isDeleted&&(r[o][t]=P())},C=async e=>{await new Promise(t=>{setTimeout(()=>t(!0),e)})},Ee=e=>{const{value:u,count:t}=e;return ie[u]*t},xe=e=>{const{count:u}=e,t=u-3;return t/10*(2*t)+1};const l=q,d=H,b=O;function Ce(e){const{value:u}=e;return l("div",{className:`cell ${u.isKilled&&"cell-killing"}`,style:{backgroundImage:`url(${K[u.value]})`,backgroundPosition:"center center",backgroundSize:"cover"}})}function Be(e,u){const t=[e[0],e[1]],o=[Math.abs(u[0]),Math.abs(u[1])];return console.log("moveXY",u),console.log("targetIdx",e),o[0]===0&&o[1]===0||Math.max(...o)<ce||(o[0]>o[1]?u[0]>0?t[1]+=1:t[1]-=1:u[1]>0?t[0]+=1:t[0]-=1,console.log("swapIdx",t),t[0]<0||t[1]<0||t[0]>=E||t[1]>=E)?null:t}function A(e){if(e instanceof MouseEvent)return[e.clientX,e.clientY];if(e instanceof TouchEvent){var u=e.touches[0]||e.changedTouches[0];return[u.clientX,u.clientY]}return[-1,-1]}function M(e){let u=e;for(;isNaN(Number(u.dataset.posy));){if(!u.parentElement)return null;u=u.parentElement}return u}function be(e){let u=null;return e instanceof MouseEvent&&(u=M(e.target)),e instanceof TouchEvent&&(u=M(e.touches[0].target)),u?[Number(u.dataset.posy),Number(u.dataset.posx)]:null}function ye(){let e=null,u=!1;return{start(t){u||(e=t)},finish(t){if(u)return{targetIdx:null,swapIdx:null};if(!e)return{targetIdx:null,swapIdx:null};const o=A(e),n=A(t);console.log("-======-");const s=be(e);if(!s)return{targetIdx:null,swapIdx:null};const c=[n[0]-o[0],n[1]-o[1]],a=Be(s,c);return e=null,{targetIdx:s,swapIdx:a}},switch(t){u=t}}}const Se=()=>X(),B=Y,ke={totalScore:0,scoreStack:[]},T=Q({name:"score",initialState:ke,reducers:{addScore:(e,u)=>{e.totalScore+=u.payload},addStack:(e,u)=>{e.scoreStack=[...e.scoreStack,...u.payload]},checkin:(e,u)=>{const t=[];let o=0;for(const n in u.payload){const s={value:Number(n),count:u.payload[n].size};s.score=Ee(s),s.rate=xe(s),t.push(s),o+=s.score*s.rate}e.totalScore+=o,e.scoreStack=[...e.scoreStack,...t]},consumeStack:e=>{e.scoreStack=e.scoreStack.slice(1)}}}),{checkin:we,consumeStack:Ve}=T.actions;var Ae=T.reducer;const Me=300,{start:Ne,finish:Ie,switch:N}=ye();function $e(){const[e,u]=D([]),t=Se();g(()=>{pe(E),o()},[]);function o(){const a=Fe();u(a)}async function n(){N(!0);let a=!1;for(;!a;){await C(Me);const f=me();o(),f&&(console.log("hasNewKilled"),t(we(f)),await C(300),ge(),o(),De(),o(),await C(1e3)),a=!f}N(!1)}function s(a){Ne(a)}function c(a){const{swapIdx:f,targetIdx:p}=Ie(a);!p||!f||(ve(p,f),o(),n())}return l(b,{children:l("div",{id:"gameboard",onMouseDown:s,onMouseUp:c,onMouseLeave:c,onTouchStart:s,onTouchEnd:c,onTouchCancel:c,style:{["--board-size"]:E},children:l(U,{children:e.filter(a=>!a.isDeleted).map(a=>{const p=`calc(${a.isDeleted?0:a.pos[1]} * var(--cell-size))`,h=a.isKilled?99:1;return l(W,{classNames:"item",children:l("div",{style:{left:`calc(${a.pos[0]} * var(--cell-size))`,["--top"]:p,width:"var(--cell-size)",height:"var(--cell-size)",zIndex:h},"data-posx":a.pos[0],"data-posy":a.pos[1],children:l(Ce,{value:a})},a.id)},a.id)})})})})}function Ke(){const[e,u]=D(!1);return d("div",{id:"header",children:[l("div",{className:"header-title",children:"\u7537\u8DB3\u6D88\u6D88\u4E50"}),l("div",{id:"helper-entrance",onClick:()=>u(!0),children:"\u26BD\u73A9\u6CD5\u4ECB\u7ECD"}),e&&l("div",{id:"helper-modal",onClick:()=>u(!1),children:d("div",{className:"helper-container",children:[l("div",{className:"helper-title",children:"\u26BD\u73A9\u6CD5\u4ECB\u7ECD\u26BD"}),l("div",{children:d("p",{children:["\u6BD4\u5F00\u5FC3\u6D88\u6D88\u4E50\u8FD8\u8981\u5F00\u5FC3\u7684\u7537\u8DB3\u6D88\u6D88\u4E50",l("br",{}),l("br",{}),"\u4E3A\u7537\u8DB3\u52A0\u6CB9\u6253\u6C14\uFF01\u63D0\u9AD8\u7403\u961F\u6218\u529B\uFF01",l("br",{}),l("br",{}),"\u4E0D\u9650\u5212\u52A8\uFF01",l("br",{}),"\u7531\u60A8\u4EB2\u624B\u4E3A\u56FD\u8DB3\u5212\u51FA\u7B2C\u4E00\u6B65\uFF01",l("br",{}),l("br",{}),"\u4E00\u8DEF\u4E0A\uFF0C\u4F1A\u6709\u6536\u83B7(\u6307\u52A0\u5206)\uFF0C",l("br",{}),"\u4E5F\u4F1A\u6709\u632B\u6298(\u6307\u6263\u5206)\uFF0C",l("br",{}),"\u4F46\u6211\u4EEC\u5BF9\u56FD\u8DB3\u7684\u70ED\u7231\u59CB\u7EC8\u90FD\u5728\uFF01"]})})]})})]})}function v(e){const{label:u,value:t}=e;return l("div",{className:"progress-block",children:d("div",{className:"progress-label",children:[l("div",{className:"labelname",children:u}),l("div",{className:"labelvalue",children:t})]})})}function Pe(){const e=B(o=>o.score.totalScore),u=100/3,t=G(()=>{let o=0;if(e<=i[0][0])return 1*u;if(e>i[i.length-1][0]){const c=(e-i[i.length-1][0])/i[i.length-1][0];return-(i.length-1+c*.6)*u}for(let c=0;c<i.length-1;c+=1)if(e>i[c][0]&&e<=i[c+1][0]){o=c;break}const n=i[o+1][0]-i[o][0],s=(e-i[o][0])/n;return-(o+s)*u},[e]);return d("div",{id:"progress",children:[l("div",{className:"progress-myPos"}),d("div",{className:"progress-container",style:{left:`${t}vw`},children:[l(v,{value:-1/0,label:"\u4E07\u4E08\u6DF1\u6E0A"}),i.map(o=>l(v,{value:o[0],label:o[1]})),l(v,{value:1/0,label:"\u6D69\u701A\u5B87\u5B99"}),l(v,{value:1/0,label:""})]})]})}const m=[];let I=0,$=0;function Te(){const[e,u]=D(0),[t,o]=D(null),n=B(h=>h.score.totalScore),s=B(h=>h.score.scoreStack),c=t&&(t.score||0)>0,a=t&&(t.rate||0)>1;let f=-1;g(()=>{u(n)},[n]),g(()=>{p(s.slice(I))},[s]),g(()=>(f=setInterval(()=>{m[$]&&o(m[$++])},500),()=>{clearInterval(f)}),[]);const p=h=>{m.push(...h),I=m.length};return d("div",{id:"score",children:[d("div",{className:"score-point",children:[l("span",{className:"label",children:"\u7403\u961F\u6218\u529B"}),l(J,{animateToNumber:e,fontStyle:{fontSize:40,fontWeight:600}})]}),t&&d("div",{className:`score-stack ${c?"score-stack-plus":"score-stack-minus"}`,children:[l("div",{className:"cover",style:{backgroundImage:`url(${K[t.value]})`}}),d("div",{children:[d("div",{className:"score",children:[d("span",{className:"value",children:[c&&"+",t.score]}),a&&d(b,{children:[d("span",{className:"rate",children:["\xD7",t.rate]}),l("span",{children:"\u{1F4A5}"})]})]}),l("div",{className:"quote",children:de[t.value]})]})]})]})}function je(){return d(b,{children:[l(Ke,{}),l($e,{}),l(Te,{}),l(Pe,{})]})}const Re=Z({reducer:{score:Ae},middleware:e=>e({serializableCheck:{ignoreActions:!0}})});_(l(ee,{store:Re,children:l(je,{})}),document.getElementById("app"));
